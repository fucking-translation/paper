# telnet 协议规范

本 RFC 制定了 ARPA Internet 社区的标准。该社区的主持人有望采用并实现这个标准。

## 介绍

TELNET 协议的目的是提供一个相对通用，双向，面向 8 位字节的通信工具。它的主要目标是允许使用标准方法互相连接终端设备以及面向终端的进程。它设想该协议也可以用于端到端的通信（“连接”）以及进程之间的通信（分布式计算）。

## 概述

TELNET 连接是一个传输控制协议（TCP）连接，用于传输带有 TELNET 控制信息的数据。

TELNET 协议基于以下三个主要思想：第一，“网络虚拟终端“的概念。第二，选项协商（negotiate）的原则。第三，终端和进程的对称（symmetric）视图。

1. 当一个 TELNET 连接第一次建立时，每个端假设都是在“网络虚拟终端”（NVT）处发起并终止。NVT 是一个虚拟设备，它提供了一个标准的，网络范围的，规范终端的中间表示（intermediate representation）。这消除了“服务器”和“用户”主机保留彼此有关终端特征以及终端处理约定的需要。用户和服务器的所有主机都映射其本地设备特征和约定，以便看起来好像正在通过网络处理 NVT，并且每个主机都可以假设另一方进行了类似的映射。NVT 旨在过度限制（不为主机提供足够丰富的词汇表以映射到其本地字符集）和过度包含之间取得平衡（用普通的终端惩罚（penalize）用户）。

     > 注：“用户”主机是指物理终端通常连接的主机，而“服务器”主机通常是指提供某种服务的主机。从另一个角度来看，即使在端到端或进程到进程之间的通信也适用，“用户”主机是发起通信的主机。

2. 选项协商原则认识到：许多主机希望提供除 NVT 内可用服务之外的其他服务，并且许多用户将拥有复杂的终端，并希望拥有优雅，而不是最少的的服务。独立于 TELNET 协议，但在 TELNET 协议中结构化的是各种不同的“选项”，这些选项将被批准（sanction）可以与“DO，DON't，WILL，WON'T”结构（下面讨论）一起使用，以允许用户和服务器达成一致，为它们的 TELNET 连接使用更详尽（elaborate，或可能不同）的约定集。这些选项可能包括更改字符集，回显模式等。

   设置使用选项的基本策略是让任何一方（或双方）发起使某些选项生效的请求。然后另一方可以接受或拒绝该请求。如果请求被接受，则该选项会立即生效；如果拒绝，则连接的关联方面将保持为 NVT 指定的状态。显然，一方可能会总是拒绝启用请求，并且绝不能因禁用某些选项而拒绝某些请求。因为双方都必须准备好支持 NVT。

   已经设置了选项协商的语法，因此，如果双方同时（simultaneously）请求一个选项，则彼此将对方的请求视为对自己的肯定确认。

3. 协商语法的对称性 (symmetry) 可能会导致确认循环无法终止 - 每一方都不会将接收的命令视为确认 (ack) 而是将其当做需要确认的新的请求。为了避免出现这样的循环，需要遵循以下规则：

     a. 各方只能请求变更选项的状态；即一方不会因为仅仅宣布它处于哪种模式就发起一个”请求“。

     b. 如果一方接收到一个要求进入它已经处于的某种模式的请求时，该请求不应该被确认。在协商中，这个 non-response 有必要阻止无尽的循环。这需要给请求返回一个响应，以更改模式 - 即使这个模式不会被修改。

     c. 无论何时，当一方 A 发送一个选项命令给另一方 B 时，不管是作为一个请求还是一个确认，该选项都将会对从 A 方发往 B 方的数据处理产生影响，并且该命令必须在数据流中希望它生效的地方插入。（应该注意在请求的发送和确认的接收之间可能需要一段时间，这可能带有负面影响。因此，主机可能会希望在请求选项之后缓存数据，直到它确定请求是否被接收，以便向用户隐藏”不确定的时期“。）


首次建立 TELNET 连接时，选项请求可能会反复跳转，因为每一方都试图获得对方最好的服务。除此之外，选项还可以用于动态修改连接的属性来适应不断改变的本地条件。比如之后将要解释的 NVT，使用的传输规则 (discipline) 非常适合许多”一次一行“的应用程序（如：BASIC），但是不适合”一次一个字符的“应用程序（如：NLS）。当服务器适合本地过程并可以协商出一个适当的选项时，它可能会选择”一次一个字符“的规则来分配额外的处理器开销。然而，与其长时间承受额外的处理器开销，在不需要详细控制时，它还可以切换(即：协商)回 NVT。